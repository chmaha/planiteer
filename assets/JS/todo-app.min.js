let isFocusActive=!1,isBreakActive=!1,focusDuration=25,shortBreakDuration=5,longBreakDuration=15,timer,itemFocusTimer,remainingTime,breakClicks=0,timerTracker,currentTaskName,resumeIndex=null,initRemainingTime=0,currentTaskIndex=0,focusMode=!1,taskStartTime=null,taskTimers=new Map,timeSpentTracker={},exited=!1,itemFocusTracker,itemFocusTime,trimmedText,lightModeColors=["#FF0B00","#FFFD00","#00FF00","#00FFF0","#0000FF","#FF00FF"],darkModeColors=["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#FFBAF0"],alarmSound=new Audio("assets/audio/gong.mp3"),completionSound=new Audio("assets/audio/completion.mp3"),itemInput=document.getElementById("itemInput"),itemInputPhone=document.getElementById("itemInput-phone"),pasteBtn=document.getElementById("pasteBtn"),pasteBtnPhone=document.getElementById("pasteBtn-phone"),buttonContainer=document.getElementById("buttonContainer"),editBtn=document.getElementById("editBtn"),todoList=document.getElementById("todoList"),addItemBtn=document.getElementById("addItemBtn"),goBtn=document.getElementById("goBtn"),doneBtn=document.getElementById("doneBtn"),prevBtn=document.getElementById("prevBtn"),nextBtn=document.getElementById("nextBtn"),isPhoneScreen=window.innerWidth<430||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),inputContainer=document.getElementsByClassName("input-container")[0],inputContainerPhone=document.getElementsByClassName("input-container-phone")[0],completedTasksContainer=document.getElementById("completedTasksContainer"),strictModeCheckbox=document.getElementById("strictModeCheckbox"),themeSwitch=document.getElementById("theme-switch"),soundsSwitch=document.getElementById("sounds-switch"),darkModeToggle=document.getElementById("darkModeToggle"),soundsToggle=document.getElementById("soundsToggle"),logo=document.getElementById("logo"),pomodoroCheckbox=document.getElementById("pomodoroCheckbox"),pomodoroSettings=document.getElementById("pomodoroSettings"),timerDisplay=document.getElementById("timerDisplay"),takeBreakBtn=document.getElementById("takeBreakBtn"),settingsLink=document.getElementById("settingsLink"),donateLink=document.querySelector(".donate-link");function loadItems(){var e=JSON.parse(localStorage.getItem("userPreferences"))||{},t=(strictModeCheckbox.checked=e.strictMode||!1,pomodoroCheckbox.checked=e.pomodoro||!1,strictModeCheckbox.parentElement.style.visibility="visible",pomodoroCheckbox.parentElement.style.visibility="visible",timerDisplay.style.display="none",takeBreakBtn.style.display="none",pomodoroCheckbox.checked?settingsLink.style.visibility="visible":settingsLink.style.visibility="hidden",focusMode=e.focusMode||!1,focusDuration=e.focus||25,shortBreakDuration=e.short||5,longBreakDuration=e.long||15,autoStart=e.autoStart||!1,autoSwitch=e.autoSwitch||!1,document.getElementById("focusDuration").value=focusDuration,document.getElementById("shortBreakDuration").value=shortBreakDuration,document.getElementById("longBreakDuration").value=longBreakDuration,document.getElementById("autoStartNextPomodoro").checked=autoStart,document.getElementById("autoSwitchToNextTask").checked=autoSwitch,breakClicks=e.breakClicks||0,isBreakActive=e.isBreakActive||!1,isFocusActive=e.isFocusActive||!1,JSON.parse(localStorage.getItem("pomodoroTimerState")));let n=0;t&&(n=t.remainingTime-1||0),isFocusActive?initRemainingTime=n/60||focusDuration:isBreakActive&&(initRemainingTime=n/60||(breakClicks%4==0?longBreakDuration:shortBreakDuration));t=JSON.parse(localStorage.getItem("todoItems"))||[];let o=e.currentTask||"",i=0;t.forEach(e=>{addItem(e.text,!0),e.done&&todoList.children[i].classList.add("done"),e.text==o&&(resumeIndex=i),i++}),taskTimers=new Map(e.taskTimers);t=JSON.parse(localStorage.getItem("itemTimerState"));t&&(e=t.itemFocusTime,taskTimers.set(resumeIndex,(taskTimers.get(resumeIndex)||0)+e)),focusMode&&startFocusMode(),isFocusActive?startPomodoroFocus():isBreakActive&&startBreak(initRemainingTime)}function saveItems(){var e=Array.from(todoList.children).map(e=>{var t=e.querySelector(".text")||e.querySelector("input.edit-text-input");return t?{text:t.textContent||t.value,done:e.classList.contains("done")}:(console.error("Item text not found, skipping item..."),{text:"",done:e.classList.contains("done")})}),t=todoList.children[currentTaskIndex],t=t&&t.querySelector(".text")?t.querySelector(".text").textContent:"",n=(currentTaskName=t,document.getElementById("autoStartNextPomodoro").checked),o=document.getElementById("autoSwitchToNextTask").checked,n={strictMode:strictModeCheckbox.checked,pomodoro:pomodoroCheckbox.checked,focus:document.getElementById("focusDuration").value,short:document.getElementById("shortBreakDuration").value,long:document.getElementById("longBreakDuration").value,autoStart:n,autoSwitch:o,focusMode:focusMode,currentTask:t,breakClicks:breakClicks,isBreakActive:isBreakActive,isFocusActive:isFocusActive,taskTimers:Array.from(taskTimers.entries())};localStorage.setItem("todoItems",JSON.stringify(e)),localStorage.setItem("userPreferences",JSON.stringify(n))}function savePomodoroTimerState(){var e={remainingTime:remainingTime};localStorage.setItem("pomodoroTimerState",JSON.stringify(e))}function saveItemTimerState(){var e={itemFocusTime:itemFocusTime};localStorage.setItem("itemTimerState",JSON.stringify(e))}function addItem(n="",o=!1){n=isPhoneScreen?n.trim()||itemInputPhone.value.trim():n.trim()||itemInput.value.trim();if(n){let e=document.createElement("li");var i=document.createElement("span"),i=(i.className="handle",i.innerHTML="<i class='fas fa-arrows-alt'></i>",e.appendChild(i),document.createElement("span"));i.className="number",i.textContent=todoList.children.length+1+".",e.appendChild(i);let t=document.createElement("span");t.className="text",t.textContent=n,e.appendChild(t);i=document.createElement("span"),n=(i.className="edit-text-btn",i.innerHTML="✏️",i.onclick=()=>enterEditMode(e,t),e.appendChild(i),document.createElement("span"));n.className="todo-delete-btn",n.textContent="✖",n.onclick=()=>{e.remove(),updateNumbers(),0===todoList.children.length&&(goBtn.style.display="none"),saveItems()},e.appendChild(n),todoList.appendChild(e),isPhoneScreen?itemInputPhone.value="":itemInput.value="",updateNumbers(),o||saveItems(),1===todoList.children.length&&(goBtn.style.display="block"),"none"===goBtn.style.display&&exitFocusMode(),pomodoroSettings.style.display="none"}}function startFocusMode(){if(document.querySelectorAll(".completed-items").forEach(e=>{e.style.display="none"}),pomodoroSettings.style.display="none","Notification"in window&&("granted"===Notification.permission?console.log("User has already granted permission for notifications."):("denied"===Notification.permission?handleNotificationDenial:requestNotificationPermission)()),focusMode=!0,saveItems(),exited){updateNumbers();for(let e=0;e<todoList.children.length;e++){var t=todoList.children[e].querySelector(".text").textContent,t=timeSpentTracker[t]||0;taskTimers.set(e,t),taskStartTime=null,exited=!1}timeSpentTracker={}}if(0<todoList.children.length){if(document.querySelectorAll(".edit-text-btn").forEach(e=>e.classList.add("hiddenItemElement")),document.querySelectorAll(".todo-delete-btn").forEach(e=>e.classList.add("hiddenItemElement")),document.querySelectorAll(".handle").forEach(e=>e.classList.add("hiddenItemElement")),null==resumeIndex){let t=!1;for(let e=0;e<todoList.children.length;e++)if(!todoList.children[e].classList.contains("done")){displayTask(currentTaskIndex=e),t=!0;break}t||displayTask(currentTaskIndex=0)}else displayTask(resumeIndex),foundUncompletedTask=!0,resumeIndex=null;document.querySelectorAll(".hiddenWhenFocused").forEach(e=>{e.classList.add("hidden")}),inputContainerPhone.style.display="none",inputContainer.style.display="none",editBtn.style.display="block",goBtn.style.display="none",prevBtn.style.visibility="visible",doneBtn.style.display="block",nextBtn.style.visibility="visible",pomodoroCheckbox.checked&&(playSound(alarmSound),timerDisplay.style.display="block",takeBreakBtn.style.display="inline");var e=strictModeCheckbox.checked;e?(prevBtn.style.display="none",nextBtn.style.display="none"):(prevBtn.style.display="block",nextBtn.style.display="block")}}function displayTask(n){itemFocusTime=0,clearInterval(itemFocusTimer),clearInterval(itemFocusTracker),itemFocusTimer=setInterval(()=>{itemFocusTime++},1e3),itemFocusTracker=setInterval(saveItemTimerState,1e3),currentTaskIndex=n,taskStartTime=Date.now(),0<=n&&n<todoList.children.length&&Array.from(todoList.children).forEach((e,t)=>{e.style.display=t===n?"block":"none"})}function markAsDoneAndNext(){todoList.children[currentTaskIndex].classList.add("done"),saveCurrentTaskTime();var e=findNextUncompleted(currentTaskIndex);-1!==e?displayTask(currentTaskIndex=e):checkCompletion(),saveItems()}function saveCurrentTaskTime(){var e;null!==taskStartTime&&(e=(Date.now()-taskStartTime)/1e3,taskTimers.set(currentTaskIndex,(taskTimers.get(currentTaskIndex)||0)+e),taskStartTime=null)}function previousTask(){saveCurrentTaskTime();var e=findPreviousUncompleted(currentTaskIndex);-1!==e&&displayTask(currentTaskIndex=e),saveItems()}function nextTask(){saveCurrentTaskTime();var e=findNextUncompleted(currentTaskIndex);-1!==e?displayTask(currentTaskIndex=e):checkCompletion(),saveItems()}function findNextUncompleted(t){for(let e=t+1;e<todoList.children.length;e++)if(!todoList.children[e].classList.contains("done"))return e;for(let e=0;e<t;e++)if(!todoList.children[e].classList.contains("done"))return e;return-1}function findPreviousUncompleted(t){for(let e=t-1;0<=e;e--)if(!todoList.children[e].classList.contains("done"))return e;for(let e=todoList.children.length-1;e>t;e--)if(!todoList.children[e].classList.contains("done"))return e;return-1}function exitFocusMode(){clearInterval(timer),clearInterval(timerTracker),clearInterval(itemFocusTimer),clearInterval(itemFocusTracker),focusMode=!1,saveItems(),isBreakActive=!1,isFocusActive=!1,saveCurrentTaskTime(),Array.from(todoList.children).forEach(e=>{e.style.display="flex",e.classList.remove("focused-task")});for(let e=0;e<todoList.children.length;e++){var t=todoList.children[e].querySelector(".text").textContent,n=taskTimers.get(e)||0;timeSpentTracker[t]=(timeSpentTracker[t]||0)+n}document.querySelectorAll(".edit-text-btn").forEach(e=>e.classList.remove("hiddenItemElement")),document.querySelectorAll(".todo-delete-btn").forEach(e=>e.classList.remove("hiddenItemElement")),document.querySelectorAll(".handle").forEach(e=>e.classList.remove("hiddenItemElement")),goBtn.style.display="block",prevBtn.style.display="none",nextBtn.style.display="none",doneBtn.style.display="none",document.querySelectorAll("#todoList li").forEach(e=>{var t=e.querySelector(".edit-text-btn");e.classList.contains("done")?(e.style.textDecoration="line-through",e.style.color="gray",t&&t.classList.add("hiddenItemElement")):t&&t.classList.remove("hiddenItemElement")}),pomodoroCheckbox.checked&&(timerDisplay.style.display="none",takeBreakBtn.style.display="none"),exited=!0,document.querySelectorAll(".hiddenWhenFocused").forEach(e=>{e.classList.remove("hidden")}),isPhoneScreen?inputContainerPhone.style.display="flex":inputContainer.style.display="flex",editBtn.style.display="none",pomodoroCheckbox.checked&&(settingsLink.style.visibility="visible")}function checkCompletion(){Array.from(todoList.children).every(e=>e.classList.contains("done"))&&completeList()}function formatTime(e){var t=Math.floor(e/60),e=Math.round(e%60);return 60===e?(t+1).toString().padStart(2,"0")+":00":t.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0")}function completeList(){focusMode=!1,isBreakActive=!1,isFocusActive=!1,breakClicks=0,"Notification"in window&&sendNotification("Planiteer",{body:"To-do list complete!",icon:"assets/images/favicon.ico"}),playSound(completionSound),setOffFireworks(),clearInterval(timerTracker),clearInterval(itemFocusTimer),clearInterval(itemFocusTracker);var e=Array.from(todoList.children).map((e,t)=>({name:e.querySelector(".text").textContent,timeSpent:taskTimers.get(t)||0})),t=e.reduce((e,t)=>e+t.timeSpent,0),e={timestamp:(new Date).toLocaleString(),tasks:e,totalTime:t},t=JSON.parse(localStorage.getItem("completedLists"))||[];0<=t.length&&(document.getElementById("clearCompletedBtn").style.display="block"),t.push(e),localStorage.setItem("completedLists",JSON.stringify(t)),createCompletedListItem(e),todoList.innerHTML="",prevBtn.style.display="none",doneBtn.style.display="none",nextBtn.style.display="none",document.querySelectorAll(".hiddenWhenFocused").forEach(e=>{e.classList.remove("hidden")}),editBtn.style.display="none",toggleResponsiveClasses(),pomodoroCheckbox.checked&&(settingsLink.style.visibility="visible",timerDisplay.style.display="none",takeBreakBtn.style.display="none"),clearInterval(timer),localStorage.removeItem("pomodoroTimerState"),localStorage.removeItem("itemTimerState"),localStorage.removeItem("todoItems"),taskTimers.clear(),localStorage.removeItem("taskTimers")}function createCompletedListItem(t){let n=document.createElement("div");n.className="completed-list",n.textContent=`${t.timestamp} (${t.tasks.length})`;var e=document.createElement("span");e.className="completed-delete-btn",e.textContent="✖",e.onclick=e=>{e.stopPropagation(),removeFromLocalStorage(t.timestamp),completedTasksContainer.removeChild(n),completedTasksContainer.removeChild(o)},n.appendChild(e);let o=document.createElement("div");o.className="completed-items",o.style.display="none",o.innerHTML=t.tasks.map((e,t)=>`<div class="task-row">
            <span class="task-name">${t+1}. ${e.name}</span>
            <span class="task-time">${formatTime(e.timeSpent)}</span>
        </div>`).join("");var e=document.createElement("div"),i=(e.className="task-row",e.style.marginTop="10px",document.createElement("span")),a=(i.className="task-name",i.style.fontWeight="bold",i.textContent="Total time:",document.createElement("span"));a.className="task-time",a.style.fontWeight="bold",a.textContent=formatTime(t.totalTime),e.appendChild(i),e.appendChild(a),o.appendChild(e),n.onclick=()=>{var e="block"===o.style.display;o.style.display=e?"none":"block"},completedTasksContainer.appendChild(n),completedTasksContainer.appendChild(o)}function toggleCompletedTasks(e){"none"===e.style.display||""===e.style.display?e.style.display="block":e.style.display="none"}function updateNumbers(){Array.from(todoList.children).forEach((e,t)=>{e.querySelector(".number").textContent=t+1+"."})}function removeFromLocalStorage(t){var e=(JSON.parse(localStorage.getItem("completedLists"))||[]).filter(e=>e.timestamp!==t);localStorage.setItem("completedLists",JSON.stringify(e))}function loadCompletedTasks(){var e=JSON.parse(localStorage.getItem("completedLists"))||[];0<e.length&&(document.getElementById("clearCompletedBtn").style.display="block"),completedTasksContainer.innerHTML="",e.forEach(e=>{createCompletedListItem(e)})}function deleteAllCompletedItems(){localStorage.removeItem("completedLists"),refreshTaskDisplay(),document.getElementById("clearCompletedBtn").style.display="none"}function refreshTaskDisplay(){document.getElementById("completedTasksContainer").innerHTML=""}function startTimer(e){pomodoroCheckbox.checked&&(clearInterval(timerTracker),timerTracker=setInterval(savePomodoroTimerState,1e3),remainingTime=60*e,saveItems(),updateTimerDisplay(),clearInterval(timer),timer=setInterval(()=>{remainingTime--,updateTimerDisplay(),remainingTime<=0&&(clearInterval(timer),playSound(alarmSound),breakClicks++,"Notification"in window&&sendNotification("Planiteer",{body:"Time to take a break...",icon:"assets/images/favicon.ico",requireInteraction:!0}),breakClicks%4==0?0<initRemainingTime?startBreak(initRemainingTime):startBreak(longBreakDuration):0<initRemainingTime?startBreak(initRemainingTime):startBreak(shortBreakDuration))},1e3)),initRemainingTime=0}function startBreak(e){isFocusActive=!1,isBreakActive=!0,saveCurrentTaskTime(),clearInterval(itemFocusTimer),itemFocusTime=0,saveItemTimerState(),remainingTime=60*e,updateTimerDisplay(),takeBreakBtn.textContent="Start Next Pomodoro",clearInterval(itemFocusTracker),clearInterval(timerTracker),timerTracker=setInterval(savePomodoroTimerState,1e3),clearInterval(timer),timer=setInterval(()=>{remainingTime--,updateTimerDisplay(),remainingTime<=0&&(clearInterval(timer),playSound(alarmSound),document.getElementById("autoStartNextPomodoro").checked&&startPomodoroFocus(),"Notification"in window)&&sendNotification("Planiteer",{body:"Time to start the next pomodoro ("+currentTaskName+")",icon:"assets/images/favicon.ico",requireInteraction:!0})},1e3),prevBtn.style.visibility="hidden",strictModeCheckbox.checked?doneBtn.style.visibility="hidden":doneBtn.style.display="none",nextBtn.style.visibility="hidden",initRemainingTime=0,saveItems()}function startPomodoroFocus(){isFocusActive=!0,isBreakActive=!1,playSound(alarmSound),document.getElementById("autoSwitchToNextTask").checked&&nextTask(),focusDuration=document.getElementById("focusDuration").value||25,0<initRemainingTime?startTimer(initRemainingTime):startTimer(focusDuration),takeBreakBtn.textContent="Take a Break",prevBtn.style.visibility="visible",strictModeCheckbox.checked?doneBtn.style.visibility="visible":doneBtn.style.display="block",nextBtn.style.visibility="visible",itemFocusTime=0,clearInterval(itemFocusTimer),clearInterval(itemFocusTracker),itemFocusTimer=setInterval(()=>{itemFocusTime++},1e3),itemFocusTracker=setInterval(saveItemTimerState,1e3),initRemainingTime=0}function updateTimerDisplay(){var e=Math.floor(remainingTime/60),t=remainingTime%60;timerDisplay.textContent=String(e).padStart(2,"0")+":"+String(t).padStart(2,"0")}function togglePomodoroElements(){pomodoroCheckbox.checked?settingsLink.style.visibility="visible":(settingsLink.style.visibility="hidden",pomodoroSettings.style.display="none",timerDisplay.style.display="none",takeBreakBtn.style.display="none")}function playSound(e){document.getElementById("soundsToggle").checked&&(e.currentTime=0,e.play().catch(e=>console.error("Failed to play sound:",e)))}function setOffFireworks(){let t=Date.now()+3e3,n={startVelocity:30,spread:360,ticks:60,zIndex:0};function o(e,t){return Math.random()*(t-e)+e}let i=setInterval(function(){var e=t-Date.now();if(e<=0)return clearInterval(i);e=e/3e3*50;confetti(Object.assign({},n,{particleCount:e,origin:{x:o(.1,.3),y:Math.random()-.2}})),confetti(Object.assign({},n,{particleCount:e,origin:{x:o(.7,.9),y:Math.random()-.2}}))},250)}function sendNotification(e,t){"granted"===Notification.permission?new Notification(e,t).onclick=function(e){e.preventDefault(),window.focus()}:console.log("Notifications are not allowed")}function showPasteDropdown(){document.getElementById("pasteDropdown").style.display="block"}function hidePasteDropdown(){document.getElementById("pasteDropdown").style.display="none",document.getElementById("pasteInput").value=""}function savePastedTasks(){parseTasks(document.getElementById("pasteInput").value).forEach(e=>addItem(e,!0)),hidePasteDropdown(),saveItems()}function parseTasks(e){return e.split("\n").map(e=>e.trim()).filter(e=>""!==e)}function requestNotificationPermission(){Notification.requestPermission().then(e=>{switch(e){case"granted":console.log("User has granted permission for notifications.");break;case"denied":handleNotificationDenial();break;default:console.log("Notification permission request was dismissed.")}})}function handleNotificationDenial(){localStorage.getItem("notificationAlertShown")||(alert("The popup notification is blocked by the browser. Please allow it by clicking the bell icon on the URL bar."),localStorage.setItem("notificationAlertShown","true"))}function handleKeyPress(e){"Enter"===e.key&&addItem()}function initializeEventListeners(){var e=document.getElementById("itemInput"),t=document.getElementById("itemInput-phone"),n=document.getElementById("addItemBtn");n?.removeEventListener("click",addItem),e?.removeEventListener("keypress",handleKeyPress),isPhoneScreen?(pasteBtnPhone.addEventListener("click",showPasteDropdown),n&&(n.addEventListener("click",()=>addItem("")),t.addEventListener("keypress",handleKeyPress))):(pasteBtn.addEventListener("click",showPasteDropdown),e&&e.addEventListener("keypress",handleKeyPress))}function toggleResponsiveClasses(){var e=window.innerWidth<=430,t=navigator.userAgent||navigator.vendor||window.opera,n=/android/i.test(t),t=/iPad|iPhone|iPod/.test(t)&&!window.MSStream;isPhoneScreen=e||n||t?(focusMode||(inputContainerPhone.style.display="flex",buttonContainer.style.display="flex",addItemBtn.style.display="flex",itemInputPhone.style.display="flex",pasteBtnPhone.style.display="flex"),inputContainer.style.display="none",itemInput.style.display="none",pasteBtn.style.display="none",!0):(inputContainerPhone.style.display="none",buttonContainer.style.display="none",addItemBtn.style.display="none",itemInputPhone.style.display="none",pasteBtnPhone.style.display="none",focusMode||(inputContainer.style.display="flex",itemInput.style.display="block",pasteBtn.style.display="flex"),!1)}window.addEventListener("resize",()=>{toggleResponsiveClasses(),initializeEventListeners()}),document.getElementById("goBtn").addEventListener("click",()=>{let e;focusDuration=document.getElementById("focusDuration").value||25,shortBreakDuration=document.getElementById("shortBreakDuration").value||5,longBreakDuration=document.getElementById("longBreakDuration").value||15;var t;exited?pomodoroCheckbox.checked?(t=JSON.parse(localStorage.getItem("userPreferences"))||{},isBreakActive=t.isBreakActive||!1,isFocusActive=t.isFocusActive||!1,t=JSON.parse(localStorage.getItem("pomodoroTimerState")),e=t?.remainingTime-1||0,initRemainingTime=isFocusActive?e/60||focusDuration:isBreakActive?e/60||(breakClicks%4==0?longBreakDuration:shortBreakDuration):0,startFocusMode(),isBreakActive?startBreak(initRemainingTime):startPomodoroFocus()):(clearInterval(timer),clearInterval(timerTracker),localStorage.removeItem("pomodoroTimerState"),startFocusMode()):(startFocusMode(),pomodoroCheckbox.checked?startPomodoroFocus():(isFocusActive=!1,isBreakActive=!1)),saveItems()}),editBtn.addEventListener("click",exitFocusMode),doneBtn.addEventListener("click",markAsDoneAndNext),prevBtn.addEventListener("click",previousTask),nextBtn.addEventListener("click",nextTask),pomodoroCheckbox.addEventListener("change",togglePomodoroElements),document.getElementById("clearCompletedBtn").addEventListener("click",deleteAllCompletedItems),document.addEventListener("DOMContentLoaded",()=>{toggleResponsiveClasses();var e=localStorage.getItem("theme")||"light",e=(setBackground(e),"dark"===e&&(document.body.classList.add("dark-theme"),donateLink.classList.add("dark-theme"),darkModeToggle.checked=!0,logo.src="assets/images/planiteer_light.webp"),localStorage.getItem("soundsEnabled")),e=(soundsToggle.checked=null===e||"true"===e,JSON.parse(localStorage.getItem("completedLists"))||[]);0<e.length&&(document.getElementById("clearCompletedBtn").style.display="block"),completedTasksContainer.innerHTML="",e.forEach(e=>{createCompletedListItem(e)}),togglePomodoroElements(),loadItems(),saveItems(),initializeEventListeners()}),darkModeToggle.addEventListener("change",function(){darkModeToggle.checked?(document.body.classList.add("dark-theme"),donateLink.classList.add("dark-theme"),localStorage.setItem("theme","dark"),logo.src="assets/images/planiteer_light.webp",setBackground("dark")):(document.body.classList.remove("dark-theme"),donateLink.classList.remove("dark-theme"),localStorage.setItem("theme","light"),logo.src="assets/images/planiteer.webp",setBackground("light"))}),soundsToggle.addEventListener("change",function(){localStorage.setItem("soundsEnabled",soundsToggle.checked)}),takeBreakBtn.addEventListener("click",()=>{isFocusActive?(isFocusActive=!1,breakClicks++,clearInterval(timer),breakClicks%4==0?startBreak(longBreakDuration):startBreak(shortBreakDuration)):startPomodoroFocus()}),pomodoroCheckbox.addEventListener("change",()=>{pomodoroCheckbox.checked?settingsLink.style.visibility="visible":(settingsLink.style.visibility="hidden",pomodoroSettings.style.display="none")}),document.querySelectorAll('input[type="number"]').forEach(e=>{e.addEventListener("input",()=>{e.value&&e.value<1&&(e.value=1)}),e.addEventListener("blur",()=>{""===e.value&&("focusDuration"===e.id?e.value=focusDuration:"shortBreakDuration"===e.id?e.value=shortBreakDuration:"longBreakDuration"===e.id?e.value=longBreakDuration:e.value=1)})}),document.getElementById("toggleSettings").addEventListener("click",e=>{e.preventDefault(),"none"===pomodoroSettings.style.display?pomodoroSettings.style.display="block":pomodoroSettings.style.display="none"}),document.getElementById("saveTasksBtn").addEventListener("click",savePastedTasks),document.getElementById("cancelPasteBtn").addEventListener("click",hidePasteDropdown);let backgroundChangeListenerAdded=!1;function setBackground(t){let n=document.getElementById("backgroundSelector"),o="assets/images/backgrounds/";function i(){var e=n.value,t=(document.body.style.backgroundImage=`url('${o}${e}.webp')`,localStorage.getItem("theme")||"light");"dark"===t?localStorage.setItem("selectedDarkBackground",e):localStorage.setItem("selectedLightBackground",e)}fetch("backgrounds.json").then(e=>e.json()).then(e=>{e="dark"===t?e.dark:e.light,e.sort(),n.innerHTML="",e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),e="dark"===t?"leaves_dark":"leaves",e=localStorage.getItem("dark"===t?"selectedDarkBackground":"selectedLightBackground")||e;document.body.style.backgroundImage=`url('${o}${e}.webp')`,n.value=e,backgroundChangeListenerAdded||(n.addEventListener("change",i),backgroundChangeListenerAdded=!0)}).catch(e=>console.error("Error fetching background images:",e))}function enterEditMode(t,r){var e=r.textContent,n=t.querySelector(".edit-text-btn");n&&n.classList.add("hiddenItemElement");let o=document.createElement("input");function i(e){"Enter"===e.key&&a(t,o)}o.type="text",o.className="edit-text-input",o.value=e,t.replaceChild(o,r),o.focus(),o.removeEventListener("keydown",i),o.addEventListener("keydown",i);n=document.createElement("span");function a(e,t){var n,o,i=t.value.trim();let a=r.textContent.trim();i&&i!==a&&(r.textContent=i,timeSpentTracker[a]&&(timeSpentTracker[i]=timeSpentTracker[a],delete timeSpentTracker[a]),-1!==(o=(n=Array.from(todoList.children)).findIndex(e=>{e=e.querySelector(".text");return e&&e.textContent.trim()===a}))&&(o=(n=n[o]).classList.contains("done"),(s=n.querySelector(".text"))&&(s.textContent=i),o?n.classList.add("done"):n.classList.remove("done")),saveItems()),e.replaceChild(r,t);var s=e.querySelector(".save-btn"),i=(s&&e.removeChild(s),e.querySelector(".edit-text-btn"));i&&i.classList.remove("hiddenItemElement")}n.className="save-btn",n.textContent="✔️",n.onclick=()=>a(t,o),t.insertBefore(n,o.nextSibling)}let sortable=Sortable.create(todoList,{animation:150,handle:".handle",onEnd:function(){updateNumbers(),saveItems()}});